<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    
    <!-- Primary Meta Tags -->
    <title>Danh Sách Thông Tin - hieunotes</title>
    <meta name="title" content="Danh Sách Thông Tin - hieunotes" />
    <meta name="description" content="Thông tin từ cộng đồng" />
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website" />
    <meta property="og:url" content="/info.html" />
    <meta property="og:title" content="Danh Sách Thông Tin - hieunotes" />
    <meta property="og:description" content="Thông tin từ cộng đồng" />
    <meta property="og:image" content="https://hieunotes.vercel.app/640px-Flag_of_Vietnam.png" />
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image" />
    <meta property="twitter:url" content="/info.html" />
    <meta property="twitter:title" content="Danh Sách Thông Tin - hieunotes" />
    <meta property="twitter:description" content="Thông tin từ cộng đồng" />
    <meta property="twitter:image" content="https://hieunotes.vercel.app/640px-Flag_of_Vietnam.png" />
    
    <!-- Favicon -->
    <link href="../favicon.ico" rel="icon" type="image/x-icon"/>

    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    
    <!-- Google Fonts -->
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap">

    <style>
        body {
            font-family: 'Inter', sans-serif;
        }
        .info-item {
            position: relative;
            padding-left: 2rem;
        }
        .info-item::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 2px;
            background-color: #e2e8f0;
        }
        .info-item:first-child::before {
            top: 1.5rem;
        }
        .info-item:last-child::before {
            bottom: calc(100% - 1.5rem);
        }
        .info-dot {
            position: absolute;
            left: -0.5rem;
            top: 1.5rem;
            width: 1rem;
            height: 1rem;
            border-radius: 50%;
            background-color: #3b82f6;
            border: 3px solid #fff;
            box-shadow: 0 0 0 3px #3b82f6;
            z-index: 10;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-fade-in {
            animation: fadeIn 0.5s ease-out;
        }
        .avatar {
            width: 3rem;
            height: 3rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
            font-size: 1.2rem;
        }
    </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <!-- Back Button -->
        <div class="mb-6">
            <a href="index.html" class="inline-flex items-center gap-2 text-slate-600 hover:text-blue-600 transition-colors duration-300">
                <i class="bi bi-arrow-left"></i>
                <span>Quay lại trang chủ</span>
            </a>
        </div>

        <!-- Profile Header -->
        <header class="text-center mb-10 animate-fade-in">
            <img src="../images/avatar_nobg.png" alt="Đặng Trung Hiếu" 
                 class="w-32 h-32 rounded-full object-cover border-4 border-white shadow-lg mx-auto mb-6">
            <h1 class="text-4xl font-bold mb-2">Danh Sách Thông Tin</h1>
            <p class="text-slate-600 mb-6 max-w-2xl mx-auto">Thông tin từ cộng đồng</p>        
         
            <!-- Stats -->
            <div class="grid grid-cols-1 md:grid-cols-1 gap-4 max-w-2xl mx-auto">
                <div class="bg-white rounded-lg p-4 shadow-md text-center">
                    <div class="text-2xl font-bold text-blue-600" id="totalCount">--</div>
                    <div class="text-sm text-slate-500">Tổng số</div>
                </div>
            </div>
        </header>

        <!-- Hoàng Sa & Trường Sa -->
        <div class="flex justify-center mb-8">
            <div class="flex items-center gap-3 px-6 py-3 rounded-full bg-red-800 text-white shadow-lg">
                <img src="../images/vn_flag.svg" alt="Vietnam" class="w-6 h-6 rounded-sm shadow">
                <span class="font-medium">Hoàng Sa & Trường Sa là của Việt Nam!</span>
            </div>
        </div>

        <!-- Info Container -->
        <div id="infoContainer" class="space-y-8">
            <!-- Loading State -->
            <div class="flex items-center justify-center py-12">
                <div class="text-center">
                    <i class="bi bi-hourglass-split text-3xl text-slate-400 mb-3 inline-block animate-pulse"></i>
                    <div class="text-slate-500">Đang tải thông tin...</div>
                </div>
            </div>
        </div>
    </div>

    <!-- jQuery -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    
    <script>
        $(document).ready(function() {
            // Fetch data from API
            $.ajax({
                url: 'https://opensheet.elk.sh/13Tmjwyy3LGiom3HHpRHNiccdbi1nRQuV2GAaWCaeaJA/info!A1:E1000',
                method: 'GET',
                dataType: 'json',
                success: function(data) {
                    if (data && data.length > 0) {
                        // Reverse the data array to show newest first
                        const reversedData = data.reverse();
                        
                        // Update stats
                        $('#totalCount').text(reversedData.length);
                        
                        // Render items
                        renderInfoItems(reversedData);
                    } else {
                        showEmptyState();
                    }
                },
                error: function(error) {
                    console.error('Lỗi tải thông tin:', error);
                    showErrorState();
                }
            });
            
            // Generate random color for avatar
            function getRandomColor() {
                const colors = [
                    'bg-blue-500', 'bg-purple-500', 'bg-pink-500', 
                    'bg-green-500', 'bg-orange-500', 'bg-red-500',
                    'bg-indigo-500', 'bg-teal-500', 'bg-cyan-500'
                ];
                return colors[Math.floor(Math.random() * colors.length)];
            }
            
            // Get initials from name
            function getInitials(name) {
                if (!name) return '?';
                
                const words = name.trim().split(' ');
                if (words.length === 1) {
                    return words[0].charAt(0).toUpperCase();
                } else {
                    return (words[0].charAt(0) + words[words.length - 1].charAt(0)).toUpperCase();
                }
            }
            
            // Render info items
            function renderInfoItems(data) {
                const container = $('#infoContainer');
                container.empty();
                
                data.forEach((item, index) => {
                    if (item.name) {
                        const randomColor = getRandomColor();
                        const initials = getInitials(item.name);
                        
                        const itemElement = `
                            <div class="info-item animate-fade-in">
                                <div class="info-dot"></div>
                                <div class="bg-white rounded-xl shadow-lg p-6 hover:-translate-y-1 hover:shadow-xl transition-all duration-300">
                                    <div class="flex flex-col md:flex-row md:items-start gap-4">
                                        <!-- Avatar -->
                                        <div class="flex-shrink-0 flex flex-col items-center gap-3">
                                            <div class="avatar ${randomColor}">
                                                ${initials}
                                            </div>
                                        </div>
                                        
                                        <!-- Content -->
                                        <div class="flex-1">
                                            <div class="mb-4">
                                                <h3 class="text-xl font-semibold text-slate-900 mb-2">${escapeHtml(item.name)}</h3>
                                                
                                                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <!-- Age -->
                                                    ${item.age ? `
                                                        <div class="flex items-center gap-2">
                                                            <i class="bi bi-calendar3 text-blue-600"></i>
                                                            <div>
                                                                <div class="text-slate-500 text-sm">Năm sinh/Tuổi</div>
                                                                <div class="font-medium">${escapeHtml(item.age)}</div>
                                                            </div>
                                                        </div>
                                                    ` : ''}
                                                    
                                                    <!-- Location -->
                                                    ${item.where ? `
                                                        <div class="flex items-start gap-2">
                                                            <i class="bi bi-geo-alt text-blue-600 mt-1"></i>
                                                            <div>
                                                                <div class="text-slate-500 text-sm">Địa chỉ</div>
                                                                <div class="font-medium whitespace-pre-line">${escapeHtml(item.where)}</div>
                                                            </div>
                                                        </div>
                                                    ` : ''}
                                                </div>
                                            </div>
                                            
                                            <!-- Additional fields -->
                                            ${getAdditionalFields(item)}
                                        </div>
                                    </div>
                                </div>
                            </div>
                        `;
                        
                        container.append(itemElement);
                    }
                });
            }
            
            // Get additional fields (excluding date, name, age, where)
            function getAdditionalFields(item) {
                const excludedFields = ['date', 'name', 'age', 'where'];
                let additionalHtml = '';
                
                for (const key in item) {
                    if (!excludedFields.includes(key) && item[key]) {
                        additionalHtml += `
                            <div class="mt-3 pt-3 border-t border-slate-200">
                                <div class="text-slate-500 text-sm capitalize">${key.replace(/_/g, ' ')}</div>
                                <div class="font-medium mt-1 whitespace-pre-line">${escapeHtml(item[key])}</div>
                            </div>
                        `;
                    }
                }
                
                return additionalHtml;
            }
            
            // Escape HTML to prevent XSS
            function escapeHtml(text) {
                if (!text) return '';
                const div = document.createElement('div');
                div.textContent = text;
                return div.innerHTML;
            }
            
            // Show empty state
            function showEmptyState() {
                $('#infoContainer').html(`
                    <div class="flex flex-col items-center justify-center py-12 text-center">
                        <i class="bi bi-inbox text-5xl text-slate-300 mb-3"></i>
                        <div class="text-slate-500 font-medium">Không có thông tin nào</div>
                        <div class="text-slate-400 text-sm mt-1">Dữ liệu đang được cập nhật</div>
                    </div>
                `);
            }
            
            // Show error state
            function showErrorState() {
                $('#infoContainer').html(`
                    <div class="flex flex-col items-center justify-center py-12 text-center">
                        <i class="bi bi-exclamation-triangle text-5xl text-red-400 mb-3"></i>
                        <div class="text-red-600 font-medium">Không thể tải thông tin</div>
                        <div class="text-slate-500 text-sm mt-1">Vui lòng thử lại sau</div>
                    </div>
                `);
            }
        });
    </script>

    <!-- Cloudflare Web Analytics -->
    <script defer src='https://static.cloudflareinsights.com/beacon.min.js' data-cf-beacon='{"token": "9f1080048ce24bdb91a28cb9db818f72"}'></script>
</body>
</html>